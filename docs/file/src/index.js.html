<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/index.js | @variate/engine</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Variate AB testing engine for modern applications"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="@variate/engine"><meta property="twitter:description" content="Variate AB testing engine for modern applications"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/index.js~Variate.html">Variate</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components">components</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/event.js~Event.html">Event</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/options.js~Options.html">Options</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#config">config</a><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-name">name</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-styles">styles</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-version">version</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-EVENT_CLICK">EVENT_CLICK</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-EVENT_PAGEVIEW">EVENT_PAGEVIEW</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#lang">lang</a><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-LOADING_EXPERIMENTS">LOADING_EXPERIMENTS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-QUERY_PARAMS">QUERY_PARAMS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-REPORTING_CUSTOM_REPORTER">REPORTING_CUSTOM_REPORTER</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-REPORTING_DISABLED">REPORTING_DISABLED</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-REPORTING_EVENT_NOT_TRACKED">REPORTING_EVENT_NOT_TRACKED</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-REPORTING_EVENT_TRACKED">REPORTING_EVENT_TRACKED</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SEGMENTING_NOT_QUALIFIED">SEGMENTING_NOT_QUALIFIED</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SEGMENTING_QUALIFIED">SEGMENTING_QUALIFIED</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SETUP_ENVIRONMENT">SETUP_ENVIRONMENT</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SETUP_OPTIONS">SETUP_OPTIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-TARGETING_NOT_QUALIFIED">TARGETING_NOT_QUALIFIED</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-TARGETING_QUALIFIED">TARGETING_QUALIFIED</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-IS_QUALIFIED_TYPE_ERROR">IS_QUALIFIED_TYPE_ERROR</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-IS_READY_TYPE_ERROR">IS_READY_TYPE_ERROR</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-REPORTING_INVALID_REPORTER">REPORTING_INVALID_REPORTER</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-REQUIRED_PARAMETERS">REQUIRED_PARAMETERS</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#utilities">utilities</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-doNotTrack">doNotTrack</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-height">height</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-href">href</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-search">search</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-width">width</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-UA">UA</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-inBrowser">inBrowser</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-isAndroid">isAndroid</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-isChrome">isChrome</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-isEdge">isEdge</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-isFF">isFF</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-isIE">isIE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-isIE9">isIE9</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-isIOS">isIOS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-isPhantomJS">isPhantomJS</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/index.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">// @flow
import jsonLogic from &apos;json-logic-js&apos;;
import deepmerge from &apos;deepmerge&apos;;
import get from &apos;get-value&apos;;
import version from &apos;./lang/version&apos;;
import Options from &apos;./components/options&apos;;
import Event from &apos;./components/event&apos;;
import * as eventTypes from &apos;./config/event-types&apos;;
import * as debug from &apos;./lang/debug&apos;;
import * as errors from &apos;./lang/errors&apos;;
import env from &apos;./utilities/env&apos;;

const LOCAL_STORAGE_UUID_KEY = &apos;variate-uuid&apos;;
const LOCAL_STORAGE_MAIN_TRAFFIC_BUCKET_KEY = &apos;variate-main-bucket&apos;;
const LOCAL_STORAGE_TRAFFIC_BUCKETS_KEY = &apos;variate-buckets&apos;;

class Variate {
    _options: Object;
    _config: Object;
    _env: Object;
    _experiments: Array&lt;Object&gt;;
    _isReady: boolean;
    _isQualified: boolean;

    /**
     * @param {object} options
     */
    constructor(options: Object) {
        options.debug &amp;&amp; version.show();
        this.setupOptions(options);
    }

    /**
     * Get testing options
     * @returns {Options}
     */
    get options(): Options {
        return this._options;
    }

    /**
     * Set testing options
     * @param options
     */
    set options(options: Options) {
        this._options = options;
    }

    /**
     * Get testing configuration
     * @returns {object}
     */
    get config() {
        return this._options.config;
    }

    /**
     * Set testing configuration
     * @param config
     */
    set config(config: Object) {
        this._options.config = config;
    }

    /**
     * Get status of the testing tool
     * @returns {boolean}
     */
    get isReady() {
        return this._isReady;
    }

    /**
     * Set status of the testing tool
     * @param value
     */
    set isReady(value: boolean) {
        if (typeof value !== &apos;boolean&apos;) {
            throw new TypeError(errors.IS_READY_TYPE_ERROR);
        }
        this._isReady = value;
    }

    /**
     * Get qualification status for visitor
     * @returns {boolean}
     */
    get isQualified(): boolean {
        return this._isQualified;
    }

    /**
     * Set qualification status for visitor
     * @param value
     */
    set isQualified(value: boolean): void {
        if (typeof value !== &apos;boolean&apos;) {
            throw new TypeError(errors.IS_QUALIFIED_TYPE_ERROR);
        }
        this._isQualified = value;
    }

    /**
     * Get testing environment
     * @returns {object}
     */
    get env(): Object {
        return this._env;
    }

    /**
     * Set testing environment
     * @param value
     */
    set env(value: Object): void {
        this._env = Object.assign({}, this._env, value);
    }

    /**
     * Get active experiments
     * @returns {Array}
     */
    get experiments(): Array&lt;Object&gt; {
        return this._experiments || [];
    }

    /**
     * Set active experiments
     * @param value
     */
    set experiments(value: Array&lt;Object&gt;) {
        this._experiments = value || [];
    }

    /**
     * Get active experiments
     * @returns {Array&lt;Object&gt;}
     */
    get variations(): Array&lt;Object&gt; {
        return this.experiments.map((experiment) =&gt; experiment.variations).reduce((acc, val) =&gt; acc.concat(val), []);
    }

    /**
     * Get all components
     * @returns {Object}
     */
    get components(): Object {
        return deepmerge.all(this.variations.map(this.extractVariationComponents.bind(this)));
    }

    /**
     * Extract variation components
     * @param variation
     * @returns {array}
     */
    extractVariationComponents(variation: Object) {
        const bucket = this.getExperimentBucket({ id: variation.experiment_id });

        for (let component: Object of Object.entries(variation.components)) {
            component.shift();
            component[0].experiments = [];
            component[0].experiments.push({
                experiment: variation.experiment_id,
                variation: variation.id,
                bucket: bucket,
                attributes: component[0].attributes
            });
        }

        return variation.components;
    }

    /**
     * Generate visitor UUID
     * @returns {string}
     */
    static generateUUID() {
        let timestamp = Date.now();

        return &apos;V-&apos; + timestamp + &apos;-&apos; + parseInt(Math.floor(Math.random() * 900000000) + 100000000);
    }

    /**
     * Bucket number generator from 0 to 100
     * @returns {number}
     */
    static generateTrafficBucket() {
        return Math.round(Math.random() * 100);
    }

    /**
     * Get query parameters from window.Location object if needed
     * @param url
     * @returns {object}
     */
    static extractQueryParams(url: string = &apos;&apos;) {
        let params = {};

        const queryParams = Object(url.substr(1).split(&apos;&amp;&apos;).filter(item =&gt; item.length));

        for (let i = 0; i &lt; queryParams.length; i++) {
            let [key, value] = queryParams[i].split(&apos;=&apos;);

            if (!isNaN(value)) {
                params[key] = Number(value);
            } else if (value === &apos;true&apos; || value === &apos;false&apos;) {
                params[key] = value === &apos;true&apos;;
            } else {
                params[key] = value;
            }
        }

        return params;
    }

    /**
     * Initialize testing:
     * use this when loading the page for the first time
     */
    initialize(config: Object, callback: Function) {
        this.options.debug &amp;&amp; console.time(&apos;[BENCHMARK] Variate Initialization&apos;);
        this.setupEnvironment(config);
        this.qualify();
        this.isReady = true;
        this.options.debug &amp;&amp; console.timeEnd(&apos;[BENCHMARK] Variate Initialization&apos;);

        if (typeof callback == &apos;function&apos;) {
            callback();
        }
    }

    /**
     * Initialize options
     */
    setupOptions(options: Object) {
        this.options = new Options(options);

        if (this.options.debug) {
            console.groupCollapsed(debug.SETUP_OPTIONS);
            console.log(options);
            console.groupEnd();
        }
    }

    /**
     * Initialize testing environment
     */
    setupEnvironment(custom: Object) {
        // View information
        const view = Object.assign(
            {
                path: get(custom, &apos;path&apos;, env.href()),
                query: get(custom, &apos;query&apos;, { default: Variate.extractQueryParams(env.search()) })
            },
            get(custom, &apos;view&apos;, { default: {} })
        );

        // Viewport information
        const viewport = {
            userId: this.getUUID(),
            mainBucket: this.getMainTrafficBucket(),
            doNotTrack: env.doNotTrack(),
            width: env.width(),
            height: env.height(),
            userAgent: env.UA,
        };

        // Targeting information
        const targeting = get(custom, &apos;targeting&apos;, { default: {} });

        this.env = { view, viewport, targeting };

        if (this.options.debug) {
            console.groupCollapsed(debug.SETUP_ENVIRONMENT);
            console.log(this.env);
            console.groupEnd();
        }
    }

    /**
     * Qualify visitor for experiments
     */
    qualify() {
        // 1. Get experiments based on bucket
        let experiments = this.loadExperiments();

        // 2. Check view targeting (URL)
        experiments = experiments.filter((experiment) =&gt; this.filterWithView(experiment));

        // 3. Check segment targeting
        experiments = experiments.filter((experiment) =&gt; this.filterWithSegment(experiment));

        // 3. Reduce to 1 variation per experiment to prepare for display
        experiments = experiments.map((experiment) =&gt; this.filterVariationsWithBucket(experiment));

        // 4. Send pageview event if enabled
        experiments.forEach((experiment) =&gt; {
            const [ variation ] = get(experiment, &apos;variations&apos;, []);

            if(this.options.pageview) {
                this.track(&apos;Pageview&apos;, eventTypes.EVENT_PAGEVIEW, {
                    experimentId: experiment.id,
                    variationId: variation.id,
                });
            }
        })

        this.experiments = experiments;
        this.isQualified = true;
    }

    /**
     * Go through experiments and load only the relevant experiments
     * based on visitor main bucket and if query params are present
     * @returns {Array}
     */
    loadExperiments() {
        let experiments = [];

        // Load live main experiments
        experiments.push(...get(this.config, &apos;live.experiments&apos;, []));

        // Load live bucketed experiments if relevant
        experiments.push(...this.getBucketedExperiments(get(this.config, &apos;live&apos;, { default: {} })));

        // Load draft experiments if query params forced
        if (this.shouldForceQueryParams()) {
            // Load draft main experiments
            experiments.push(...get(this.config, &apos;draft.experiments&apos;, []));

            // Load draft bucketed experiments if relevant
            experiments.push(...this.getBucketedExperiments(get(this.config, &apos;draft&apos;, { default: {} })));
        }

        if (this.options.debug) {
            console.groupCollapsed(debug.LOADING_EXPERIMENTS);
            console.log(experiments);
            console.groupEnd();
        }

        return experiments;
    }

    /**
     * Retrieve bucketed experiments
     * @param group
     * @returns {array}
     */
    getBucketedExperiments(group: Object) {
        if (this.getMainTrafficBucket() &lt;= get(group, &apos;bucketed.max&apos;)) {
            for (let bucket of get(group, &apos;bucketed.buckets&apos;)) {
                const max = get(bucket, &apos;max&apos;);
                if (this.getMainTrafficBucket() &lt;= max &amp;&amp; this.getMainTrafficBucket() &lt;= max) {
                    return get(bucket, &apos;experiments&apos;);
                }
            }
        }

        return [];
    }

    /**
     * Go through each experiment and filters their variation to
     * reduce to 1 based on visitor bucket
     * @param experiment
     * @returns {boolean}
     */
    filterVariationsWithBucket(experiment: Object) {
        // // @TODO Assign bucket to visitor for experiment and filter variation
        const bucket = this.getExperimentBucket(experiment);
        let variations = get(experiment, &apos;variations&apos;);

        variations = variations.filter((variation) =&gt; {
            return bucket &gt;= get(variation, &apos;traffic_allocation.min&apos;)
                &amp;&amp; bucket &lt;= get(variation, &apos;traffic_allocation.max&apos;);
        });

        variations.map((variation) =&gt; {
            variation.experiment_id = experiment.id;
            return variation;
        });

        experiment.variations = variations;

        return experiment;
    }

    /**
     * Check visitor view options and check if qualified for given experiment
     * @param experiment
     * @returns {boolean}
     */
    filterWithView(experiment: Object) {
        let isQualifiedForView = this.qualifyView(experiment);

        if (this.options.debug) {
            console.groupCollapsed(
                isQualifiedForView ? debug.TARGETING_QUALIFIED : debug.TARGETING_NOT_QUALIFIED
            );
            console.log(`Experiment: #${experiment.id} - ${experiment.name}`);
            console.log(`Current URL: ${get(this.env, &apos;view.path&apos;)}`);
            console.log(`Current Query Params: `, get(this.env, &apos;view.query&apos;));
            console.log(experiment);
            console.groupEnd();
        }

        return isQualifiedForView;
    }

    /**
     * Check visitor segment options and check if qualified for given experiment
     * @param experiment
     * @returns {boolean}
     */
    filterWithSegment(experiment: Object) {
        let isQualifiedForSegment = this.qualifySegment(experiment);

        if (this.options.debug) {
            console.groupCollapsed(
                isQualifiedForSegment ? debug.SEGMENTING_QUALIFIED : debug.SEGMENTING_NOT_QUALIFIED
            );

            console.log(`Experiment: #${experiment.id} - ${experiment.name}`);
            console.log(&apos;Rules: &apos;, get(experiment, &apos;targeting.segment&apos;));
            console.log(&apos;Data: &apos;, get(this.env, &apos;targeting&apos;));

            console.groupEnd();
        }

        return isQualifiedForSegment;
    }

    /**
     * Qualify visitor for given experiment based on current view (URL)
     * @param experiment
     * @returns {boolean}
     */
    qualifyView(experiment: Object) {
        const path = get(this.env, &apos;view.path&apos;);
        const excludes = get(experiment, &apos;targeting.views.exclude&apos;);

        for (let i = 0; i &lt; excludes.length; i++) {
            if (path.match(excludes[i])) {
                return false;
            }
        }

        const includes = get(experiment, &apos;targeting.views.include&apos;);

        if (includes != null &amp;&amp; includes.length &gt; 0) {
            if (includes[0] === &apos;*&apos;) {
                return true;
            }

            for (let i = 0; i &lt; includes.length; i++) {
                if (path.match(includes[i])) {
                    return true;
                }
            }
        }

        return false;
    }

    /**
     * Qualify visitor for given experiment based on segment
     * @param experiment
     * @returns {boolean}
     */
    qualifySegment(experiment: Object) {
        const rules = get(experiment, &apos;targeting.segment&apos;, true);
        const data = get(this.env, &apos;targeting&apos;, {});

        return jsonLogic.apply(rules, data);
    }

    /**
     * Retrieve or generate visitor UUID
     */
    getUUID() {
        let uuid = env.inBrowser &amp;&amp; localStorage.getItem(LOCAL_STORAGE_UUID_KEY);

        if (!uuid) {
            uuid = Variate.generateUUID();
            env.inBrowser &amp;&amp; localStorage.setItem(LOCAL_STORAGE_UUID_KEY, uuid);
        }

        return uuid;
    }

    /**
     * Retrieve or generate main traffic bucket for visitor
     * @returns {number}
     */
    getMainTrafficBucket() {
        let bucket = env.inBrowser &amp;&amp; localStorage.getItem(LOCAL_STORAGE_MAIN_TRAFFIC_BUCKET_KEY);

        if (!bucket) {
            bucket = Variate.generateTrafficBucket();
            env.inBrowser &amp;&amp; localStorage.setItem(LOCAL_STORAGE_MAIN_TRAFFIC_BUCKET_KEY, bucket.toString());
        }

        return bucket;
    }

    /**
     * Get a traffic bucket for a given experiment
     * @param experiment
     * @returns {number}
     */
    getExperimentBucket(experiment: Object) {
        if (env.inBrowser) {
            let bucket = localStorage.getItem(LOCAL_STORAGE_TRAFFIC_BUCKETS_KEY)
                ? JSON.parse(localStorage.getItem(LOCAL_STORAGE_TRAFFIC_BUCKETS_KEY) || &apos;&apos;)
                : {};

            if (!bucket[experiment.id]) {
                bucket[experiment.id] = Variate.generateTrafficBucket();
                env.inBrowser &amp;&amp; localStorage.setItem(LOCAL_STORAGE_TRAFFIC_BUCKETS_KEY, JSON.stringify(bucket));
            }

            return bucket[experiment.id];
        }

        return 0;
    }

    /**
     * Should the query params be forced?
     * @returns {boolean}
     */
    shouldForceQueryParams() {
        if (Object.keys(get(this.env, &apos;view.query&apos; || {})).length &amp;&amp; get(this.env, &apos;view.query.force&apos;, false)) {
            if (this.options.debug) {
                console.groupCollapsed(debug.QUERY_PARAMS);
                console.log(get(this.env, &apos;view.query&apos;) || {});
                console.groupEnd();
            }

            return true;
        }

        return false;
    }

    /**
     * Track an event to Variate Reporting API
     * @param args
     * @returns {boolean}
     */
    track(...args: Object) {
        let reporter = this.report;
        let event = this.extractTrackingArguments(args);

        if (!this.options.tracking) {
            this.options.debug &amp;&amp; console.info(debug.REPORTING_DISABLED);
            return false;
        }

        if (this.options.reporter !== null) {
            if (typeof this.options.reporter !== &apos;function&apos;) {
                throw new Error(errors.REPORTING_INVALID_REPORTER);
            }

            this.options.debug &amp;&amp; console.info(debug.REPORTING_CUSTOM_REPORTER);
            reporter = this.options.reporter;
        }

        const wasTracked = reporter(event);

        if (this.options.debug) {
            console.groupCollapsed(wasTracked ? debug.REPORTING_EVENT_TRACKED : debug.REPORTING_EVENT_NOT_TRACKED);
            console.log(event);
            console.groupEnd();
        }
    }

    extractTrackingArguments(args: Object) {
        if (!args.length) {
            throw new Error(errors.REQUIRED_PARAMETERS.replace(&apos;%s&apos;, &apos;track()&apos;));
        }

        if (typeof args[0] === &apos;string&apos;) {
            const [name, type, value] = args;
            return new Event({ name, type, value, context: this.env });
        }

        const { name, type, value } = args[0];
        return new Event({ name, type, value, context: this.env });
    }

    report(event: Event) {
        const xhr = new XMLHttpRequest();

        xhr.open(&apos;POST&apos;, &apos;https://reporting.variate.ca/track&apos;, true);
        xhr.setRequestHeader(&apos;Content-Type&apos;, &apos;application/json&apos;);
        xhr.send(event.toJson());

        return xhr.readyState === 4 ? true : false;
    }
}

export default Variate;
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
